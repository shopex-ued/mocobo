<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>表单验证器</title>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="../dist/css/mobile.min.css">
</head>

<body>
<header class="top-bar" data-topbar>
  <div class="pos-left">
    <a href="javascript:history.back();" class="icon-arrow-back"></a>
  </div>
  <h1>表单验证器</h1>
</header>

<div class="container">

  <h1>默认示例（错误消息弹出）</h1>
  <form action="" method="post" data-validator>
    <div class="form-row">
      <div class="grid-12">
        <label>用户名 <em class="text-alert">*</em>
          <input type="text" required pattern="words">
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>密码 <em class="text-alert">*</em>
          <input type="password" required>
        </label>
      </div>
    </div>
    <div class="form-row">
      <button type="submit">提交</button>
    </div>
  </form>

  <h1>预定义错误消息显示</h1>
  <form action="" method="post" data-validator>
    <div class="form-row">
      <div class="grid-12">
        <label>用户名 <em class="text-alert">*</em>
          <input type="text" required pattern="alpha">
        </label>
        <small class="alert-box error">用户名必填，并且只能为字母</small>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>Email <em class="text-alert">*</em>
          <input type="email" required>
        </label>
        <small class="alert-box error">请输入正确的电子邮箱地址</small>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>个人主页
          <input type="url" placeholder="http://">
        </label>
        <small class="alert-box error">请输入正确的URL地址</small>
      </div>
    </div>
    <div class="form-row">
      <button type="submit">提交</button>
    </div>
  </form>

  <h1>自定义错误消息弹出</h1>
  <form action="" method="post" data-validator>
    <div class="form-row">
      <div class="grid-12">
        <label>用户名 <em class="text-alert">*</em>
          <input type="text" required pattern="alpha" data-alerts="用户名必填，并且只能为字母">
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>Email <em class="text-alert">*</em>
          <input type="email" required data-alerts="请输入正确的电子邮箱地址">
        </label>
      </div>
    </div>
    <div class="form-row">
      <button type="submit">提交</button>
    </div>
  </form>

  <h1>Ajax 方式异步提交</h1>
  <form action="" method="post" data-validator="ajax">
    <div class="form-row">
      <div class="grid-12">
        <label>用户名 <em class="text-alert">*</em>
          <input type="text" required pattern="alpha_digital" data-alerts="用户名必填，包括字母和数字">
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>性别 <em class="text-alert">*</em>
          <div class="input-group">
            <input type="radio" name="b" id="for_sex_male" required data-alerts="请选择一个性别" value="0"> <label for="for_sex_male">男</label>
            <input type="radio" name="b" id="for_sex_female" value="1"> <label for="for_sex_female">女</label>
          </div>
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>年龄
          <input type="number" min="0" step="1" data-alerts="年龄只能为正数">
        </label>
      </div>
    </div>
    <div class="form-row">
      <button type="submit">提交</button>
    </div>
  </form>

  <h1>预定义的验证模式</h1>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>验证示例或格式</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>alpha</td>
        <td>字母</td>
      </tr>
      <tr>
        <td>digital</td>
        <td>纯数字</td>
      </tr>
      <tr>
        <td>alpha_digital</td>
        <td>字母和数字</td>
      </tr>
      <tr>
        <td>int</td>
        <td>整数</td>
      </tr>
      <tr>
        <td>positive</td>
        <td>正数</td>
      </tr>
      <tr>
        <td>negative</td>
        <td>负数</td>
      </tr>
      <tr>
        <td>number</td>
        <td>数值</td>
      </tr>
      <tr>
        <td>email</td>
        <td>电子邮箱</td>
      </tr>
      <tr>
        <td>url</td>
        <td>url地址</td>
      </tr>
      <tr>
        <td>domain</td>
        <td>域名，如：shopex.cn</td>
      </tr>
      <tr>
        <td>datetime</td>
        <td>日期+时间，格式：YYYY-MM-DD hh:mm:ss</td>
      </tr>
      <tr>
        <td>date</td>
        <td>日期，格式：YYYY-MM-DD</td>
      </tr>
      <tr>
        <td>time</td>
        <td>时间，格式：HH:MM:SS</td>
      </tr>
      <tr>
        <td>color</td>
        <td>hex颜色值，如：#FFF或#FFFFFF</td>
      </tr>
      <tr>
        <td>mobile</td>
        <td>国内的手机号码，如：13800138000</td>
      </tr>
      <tr>
        <td>tel</td>
        <td>国内的固定电话号码，如：021-33251818-6512</td>
      </tr>
      <tr>
        <td>zip</td>
        <td>国内的邮政编码</td>
      </tr>
    </tbody>
  </table>
  <p>可以在<code>pattern</code>属性里写上对应的验证模式名：</p>
  <pre>
  &lt;input type="text" pattern="int"&gt;
  </pre>
  <p>你还可以使用标准的 html5 中的表单属性来代替验证表达式：</p>
  <pre>
  &lt;input type="email" required&gt;
  &lt;input type="url"&gt;
  </pre>

  <h1>自定义验证模式</h1>
  <pre>
  (document).mobile({
    validator: {
      patterns: {
        dashes_only: /^[\d-]*$/,
        ip_address: /^((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/
      }
    }
  });
  </pre>
  <p>然后像使用普通验证模式一样使用它：</p>
  <pre>&lt;input type="text" pattern="dashes_only"&gt;</pre>

  <h1>相等于验证器</h1>
  <p>如果需要再次确认输入的正确性，可以使用<code>data-validator-equalto</code>属性：</p>
  <form action="" method="post" data-validator>
    <div class="form-row">
      <div class="grid-12">
        <label>密码 <em>*</em>
          <input type="text" id="password" required pattern="\w+">
        </label>
        <small class="alert-box error">密码只能为字母、数字、下划线</small>
      </div>
    </div>
    <div class="form-row">
      <div class="grid-12">
        <label>确认密码 <em>*</em>
          <input type="text" required data-validator-equalto="#password">
        </label>
        <small class="alert-box error">两次密码输入不符</small>
      </div>
    </div>
    <button type="submit">提交</button>
  </form>

  <h1>必(填/选)其一</h1>
  <p>如果需要在多个选项或输入框中必须至少选中或输入其中一项，需要在表单元素上加入属性<code>data-validator-oneof</code>：</p>
  <form action="" method="post" data-validator="ajax">
    <div class="form-row">
      <label class="grid-3">联系方式：</label>
      <div class="grid-3 columns">
        <label>手机：</label>
        <input type="text" class="oneof" pattern="mobile">
      </div>
      <div class="grid-3 columns">
        <label>电话：</label>
        <input type="text" class="oneof" pattern="tel">
      </div>
      <div class="grid-3 columns">
        <label>QQ：</label>
        <input type="text" class="oneof" data-validator-oneof=".oneof" data-alerts="请至少填写其中一项">
      </div>
    </div>
    <div class="form-row">
      <button type="submit">提交</button>
    </div>
  </form>

  <h1>其它可选项</h1>
  <pre>
  $(document).mobile({
    validator: {
      validate_on: 'manual', // change (when input value changes), blur (when input blur), manual (when call custom events)
      exception: ':hidden, [data-validator-ignore]', // ignore validate with 'exception' setting
      focus_on_invalid: false, // automatically bring the focus to an invalid input field
      has_hint: true, // popup a alert window if invalid
      error_labels: true, // labels with a for="inputId" will receive an `error` class
      error_class: 'has-error', // labels with a for="inputId" will receive an `error` class
      feedback: '.form-row', // support a parent(s) selector for feedback an error message box
      alert_element: '.alert-box', // for an error message box class
      isAjax: false, // You can set ajax mode
      // the amount of time Validator will take before it validates the form (in ms).
      // smaller time will result in faster validation
      timeout: 1000,
      // You can custom patterns
      patterns: {
        alpha: /^[a-zA-Z]*$/,
        digital: /^\d*$/,
        alpha_digital: /^[a-zA-Z\d]*$/,
        words: /^\w*$/,
        int: /^[-+]?\d*$/,
        positive: /^\+?\d*(?:[\.]\d+)?$/,
        negative: /^-\d*(?:[\.]\d+)?$/,
        number: /^[-+]?\d*(?:[\.]\d+)?$/,
        mobile: /^0?(?:1(?:[38]\d)|(?:4[579])|(?:[57][0-35-9]))\d{8}$/,
        tel: /^(0\d{2,3}-?)?[2-9]\d{5,7}(-\d{1,5})?$/,
        zip: /^\d{6}$/,
        // http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#valid-e-mail-address
        email: /^[\w.!#$%&'*+\/=?^`{|}~-]+@[a-zA-Z\d](?:[a-zA-Z\d-]{0,61}[a-zA-Z\d])?(?:\.[a-zA-Z\d](?:[a-zA-Z\d-]{0,61}[a-zA-Z\d])?)*$/,
        // http://blogs.lse.ac.uk/lti/2008/04/23/a-regular-expression-to-match-any-url/
        url: /^(https?|ftp|file|ssh):\/\/([-;:&=\+\$,\w]+@{1})?([-A-Za-z\d\.]+)+:?(\d+)?((\/[-\+~%\/\.\w]+)?\??([-\+=&;%@\.\w]+)?#?([\w]+)?)?/,
        // abc.de
        domain: /^([a-zA-Z\d]([a-zA-Z\d\-]{0,61}[a-zA-Z\d])?\.)+[a-zA-Z]{2,8}$/,
        datetime: /^([0-2]\d{3})\-([0-1]\d)\-([0-3]\d)\s([0-2]\d):([0-5]\d):([0-5]\d)([-+]([0-1]\d)\:00)?$/,
        // YYYY-MM-DD
        date: /(?:19|20)\d{2}[-/.](?:(?:0?[1-9]|1[0-2])[-/.](?:0?[1-9]|1\d|2\d)|(?:(?!02)(?:0?[1-9]|1[0-2])[-/.](?:30))|(?:(?:0?[13578]|1[02])[-/.]31))$/,
        // HH:MM:SS
        time: /^(0?\d|1\d|2[0-3])(:[0-5]\d){2}$/,
        // #FFF or #FFFFFF
        color: /^#([a-fA-F\d]{6}|[a-fA-F\d]{3})$/
      },
      // You can custom verifiers
      verifiers: {
        requiredone: function(el, required, parent) {
          var $el = $(el);
          return $el.closest('[' + this.attr_name() + ']').find('input:checked[type="' + el.type + '"][name="' + el.name + '"]:not(:disabled)').length;
        },
        equalto: function(el, required, parent) {
          var from = document.querySelector(el.getAttribute(this.add_namespace(this.attr_name() + '-equalto'))).value,
            to = el.value,
            valid = (from === to);

          return valid;
        },
        oneof: function(el, required, parent) {
          var els = document.querySelectorAll(el.getAttribute(this.add_namespace(this.attr_name() + '-oneof')));
          return this.valid_oneof(els, required, parent);
        }
      },
      // You can custom alerts
      alerts: {
        required: '请{how}{placeholder}！',
        alpha: '请填写英文字母！',
        digital: '只允许填写数字！',
        alpha_digital: '请填写英文字母或数字！',
        words: '请输入英文字母、数字、下划线！',
        int: '请填写整数！',
        positive: '请填写正数！',
        negative: '请填写负数！',
        mobile: '手机号码有误，请重新填写！',
        tel: '电话号码有误，请重新填写!',
        zip: '邮政编码格式有误，请重新填写！',
        number: '请填写数值！',
        email: '请填写正确的邮箱地址！',
        url: '请填写正确的 URL 地址！',
        domain: '请填写正确的域名！',
        datetime: '请填写正确的日期和时间格式！',
        date: '请填写正确的日期格式！',
        time: '请填写正确的时间格式！',
        color: '请填写十六进制颜色格式！'
      }
    }
  });
  </pre>

  <h1>可用的事件列表</h1>
  <pre>
  $('#myForm')
  .on('invalid.validator', function () {
    var invalid_fields = $(this).find('[data-invalid]');
    console.log(invalid_fields);
  })
  .on('valid.validator', function () {
    console.log('valid!');
  })
  .on('start.ajax.validator', function () {
    console.log('ajax start!');
  })
  .on('complete.ajax.validator', function () {
    console.log('ajax complete!');
  })
  .on('success.ajax.validator', function () {
    console.log('ajax success!');
  })
  .on('error.ajax.validator', function () {
    console.log('ajax error!');
  });
  </pre>
  <p>如果需要异步提交表单，<code>form</code>的属性需改为<code>data-validator="ajax"</code>，然后在<code>success.ajax.validator</code>或<code>error.ajax.validator</code>事件里写异步回调代码。</p>

  <h1>当页面中添加了新的表单验证组件</h1>
  <pre>
  $(document).mobile('validator', 'reflow');
  </pre>

</div>

<script src="../dist/js/libs.min.js"></script>
<script src="../dist/js/mobile.min.js"></script>
<script src="../dist/js/main.min.js"></script>
<script>
$('form').on('valid.validator', function(e, event) {
    alert('验证通过!');
    $(this).mobile('validator', 'enabledSubmit', $(this));
    event.preventDefault();
});
$('[data-validator=ajax]').on('complete.ajax.validator', function(e, event) {
    $(document).mobile('tips', 'show', '已提交处理');
});
</script>
</body>
</html>
